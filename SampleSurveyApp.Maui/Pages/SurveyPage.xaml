<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SampleSurveyApp.Maui.Pages.SurveyPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:vm="clr-namespace:SampleSurveyApp.Core.ViewModels;assembly=SampleSurveyApp.Core"
             xmlns:models="clr-namespace:SampleSurveyApp.Core.Domain;assembly=SampleSurveyApp.Core"
             xmlns:controls="clr-namespace:SampleSurveyApp.Maui.Controls"
             x:Name="SurveyPageName"
             x:DataType="vm:SurveyPageVM">

    <ContentPage.Resources>
        <Style TargetType="CollectionView">
            <Style.Triggers>
                <Trigger TargetType="CollectionView" Property="IsVisible" Value="False">
                    <Setter Property="HeightRequest" Value="0"/>
                </Trigger>
                <Trigger TargetType="CollectionView" Property="IsVisible" Value="True">
                    <Setter Property="HeightRequest" Value="450"/>
                </Trigger>
            </Style.Triggers>
        </Style>
       
        <Style x:Key="InvalidEntryStyle" TargetType="Entry">
            <Setter Property="TextColor" Value="IndianRed"/>
        </Style>
        <Style x:Key="ValidEntryStyle" TargetType="Entry">
            <Setter Property="TextColor" Value="Green"/>
        </Style>
    </ContentPage.Resources>

    <Shell.TitleView>
        <controls:CustomTitleView/>
    </Shell.TitleView>

    <StackLayout>
        <StackLayout IsVisible="{Binding IsVisibleSurveyStartButton}" Padding="0,10,0,10" BackgroundColor="pink"
                     >
            <Button Text="Start a survey"
                        WidthRequest="200"
                        HeightRequest="30"
                        FontSize="Micro"
                        Command="{Binding CreateSurveyCommand}"
                        BackgroundColor="green"
                        VerticalOptions="Center"/>
        </StackLayout>

          
   <!-- Survey-->

        <!-- Survey Question Header Info-->
        <StackLayout IsVisible="{Binding IsVisibleSurveyHeader}">
            <controls:QuestionHeaderView />
       </StackLayout>

        <!-- Container for Answers -->
        <StackLayout>
             <!--QuestionType is List, RuleType is Single-->
             <CollectionView x:Name="listSingleCv"
                         ItemsSource="{Binding AnswerOptionsForCurrentQuestionCollection}"
                                SelectionMode="Single"
                                SelectedItem="{Binding UserSelectedAnswer, Mode=TwoWay}"
                                SelectionChangedCommand="{Binding AnswerSelectedCommand}"
                                SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                                BackgroundColor="Transparent"
                                Margin="12,8,12,0"
                                IsVisible="{Binding IsVisibleRuleTypeSingle}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SurveyAnswerModel">
                            <controls:AnswerOptionCardView  />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

             <!--QuestionType is List, RuleType is Multiple-->
            <CollectionView x:Name="MultipleSelectionsCV"
                            ItemsSource="{Binding AnswerOptionsForCurrentQuestionCollection}"
                            SelectionMode="Multiple"
                            SelectionChangedCommand="{Binding MultipleSelectionCommand}"
                            SelectionChangedCommandParameter="{Binding SelectedItems, Source={x:Reference MultipleSelectionsCV}}"
                            IsVisible="{Binding IsVisibleRuleTypeMultiple}">
                <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SurveyAnswerModel">
                            <controls:AnswerOptionCardView  />
                        </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

             <!--QuestionType is Text-->
            <Frame HeightRequest="200"
                    BorderColor="LightGray"
                    Padding="0"
                    IsVisible="{Binding IsVisibleQTypeText}">
                <Frame.Triggers>
                    <Trigger TargetType="Frame"
                                Property="IsVisible"
                                Value="False">
                        <Setter Property="HeightRequest"
                                Value="0"/>
                    </Trigger>
                    <Trigger TargetType="Frame"
                                Property="IsVisible"
                                Value="True">
                        <Setter Property="HeightRequest"
                                Value="450"/>
                        </Trigger>
                </Frame.Triggers>
                <controls:TextEditorCardView />
            </Frame>

          <!--REVIEW ANSWERS-->
           <CollectionView x:Name="responseCV"
                            ItemsSource="{Binding UserAnswerGroups}"
                            IsGrouped="True"
                            IsVisible="{Binding IsVisibleAnswerReview}">
                <CollectionView.GroupHeaderTemplate>
                    <DataTemplate>
                        <VerticalStackLayout>
                            <StackLayout BackgroundColor="LightYellow" Padding="5,10,5,9">
                                <Label Text="{Binding QText}" />
                            </StackLayout>
                            <BoxView BackgroundColor="LightBlue" HeightRequest="1"/>
                        </VerticalStackLayout>
                    </DataTemplate>
                </CollectionView.GroupHeaderTemplate>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <VerticalStackLayout>
                        <Label Text="{Binding AText}" Padding="5,10,5,10"/>
                        <BoxView BackgroundColor="LightBlue" HeightRequest="1"/>
                    </VerticalStackLayout>
                </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>

    </StackLayout>
      
</ContentPage>